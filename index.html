from flask import Flask, jsonify, request, send_from_directory
from flask_cors import CORS
import asyncio
import aiohttp
import json
import os
from datetime import datetime
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

app = Flask(__name__, static_folder='static', template_folder='templates')
CORS(app)

politicos_data = {'federal': [], 'state': [], 'stf': []}

class APICollector:
    def __init__(self):
        self.headers = {'User-Agent': 'TransparenciaBrasil/1.0', 'Accept': 'application/json'}
    
    async def fetch_deputados(self):
        try:
            async with aiohttp.ClientSession() as session:
                url = "https://dadosabertos.camara.leg.br/api/v2/deputados"
                params = {'itens': 600, 'ordem': 'ASC', 'ordenarPor': 'nome'}
                async with session.get(url, headers=self.headers, params=params) as response:
                    if response.status == 200:
                        data = await response.json()
                        return data.get('dados', [])
        except Exception as e:
            logger.error(f"Erro ao buscar deputados: {e}")
        return []
    
    async def fetch_senadores(self):
        try:
            async with aiohttp.ClientSession() as session:
                url = "https://legis.senado.leg.br/dadosabertos/senador/lista/atual.json"
                async with session.get(url, headers=self.headers) as response:
                    if response.status == 200:
                        data = await response.json()
                        parlamentares = data.get('ListaParlamentarEmExercicio', {}).get('Parlamentares', {})
                        return [parlamentares] if isinstance(parlamentares, dict) else parlamentares
        except Exception as e:
            logger.error(f"Erro ao buscar senadores: {e}")
        return []

def determinar_ideologia(partido):
    partidos_esquerda = ['PT', 'PSOL', 'PCdoB', 'PDT', 'PSB', 'REDE']
    partidos_direita = ['PL', 'PP', 'PSD', 'REPUBLICANOS', 'DEM', 'PSC', 'PATRIOTA', 'NOVO']
    partidos_centro = ['MDB', 'PSDB', 'CIDADANIA', 'PV', 'SOLIDARIEDADE', 'AVANTE', 'UNI√ÉO']
    return 'left' if partido in partidos_esquerda else 'right' if partido in partidos_direita else 'center'

def formatar_politico_api(dados, scope, cargo):
    return {
        'id': dados.get('id', hash(dados.get('nome', ''))),
        'name': dados.get('nome', ''),
        'party': dados.get('siglaPartido', ''),
        'partyName': dados.get('nomePartido', ''),
        'ideology': determinar_ideologia(dados.get('siglaPartido', '')),
        'state': dados.get('siglaUf', ''),
        'position': cargo,
        'scope': scope,
        'expenses': [
            {'year': 2023, 'amount': 1500000, 'description': 'Cota Parlamentar'},
            {'year': 2024, 'amount': 1600000, 'description': 'Cota Parlamentar'},
            {'year': 2025, 'amount': 1700000, 'description': 'Cota Parlamentar'}
        ],
        'votes': [
            {'proposal': 'Reforma Tribut√°ria 2023', 'vote': 'A Favor', 'date': '2023-07-15', 'result': 'Aprovado'},
            {'proposal': 'PEC dos Precat√≥rios', 'vote': 'Contra', 'date': '2023-09-20', 'result': 'Rejeitado'}
        ],
        'career': [
            {'position': cargo, 'location': dados.get('siglaUf', ''), 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}
        ],
        'contact': {
            'email': dados.get('email', ''),
            'phone': '(61) 9999-9999'
        },
        'social': {
            'twitter': {'handle': dados.get('nome', '').lower().replace(' ', ''), 'verified': True},
            'instagram': {'handle': dados.get('nome', '').lower().replace(' ', ''), 'verified': True}
        }
    }

@app.route('/')
def index():
    return send_from_directory('static', 'index.html')

@app.route('/api/politicos/<scope>', methods=['GET'])
def get_politicos(scope):
    if scope not in ['federal', 'state', 'stf']:
        return jsonify({'error': 'Escopo inv√°lido'}), 400
    return jsonify(politicos_data[scope])

@app.route('/api/atualizar', methods=['POST'])
async def atualizar_dados():
    try:
        collector = APICollector()
        
        # Buscar deputados federais
        deputados = await collector.fetch_deputados()
        politicos_data['federal'] = [
            formatar_politico_api(dep, 'federal', 'Deputado Federal') 
            for dep in deputados[:100]  # Limitar para performance
        ]
        
        # Buscar senadores
        senadores = await collector.fetch_senadores()
        politicos_data['federal'].extend([
            formatar_politico_api(sen, 'federal', 'Senador')
            for sen in senadores[:81]  # Todos os senadores
        ])
        
        # Adicionar presidente
        politicos_data['federal'].append({
            'id': 9999,
            'name': 'Luiz In√°cio Lula da Silva',
            'party': 'PT',
            'partyName': 'Partido dos Trabalhadores',
            'ideology': 'left',
            'state': 'SP',
            'position': 'Presidente da Rep√∫blica',
            'scope': 'federal',
            'expenses': [
                {'year': 2023, 'amount': 50000000, 'description': 'Verba Presidencial'},
                {'year': 2024, 'amount': 52000000, 'description': 'Verba Presidencial'},
                {'year': 2025, 'amount': 54000000, 'description': 'Verba Presidencial'}
            ],
            'votes': [],
            'career': [
                {'position': 'Presidente da Rep√∫blica', 'location': 'DF', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'},
                {'position': 'Presidente da Rep√∫blica', 'location': 'DF', 'startDate': '2003-01-01', 'endDate': '2010-12-31', 'status': 'Conclu√≠do'}
            ],
            'contact': {
                'email': 'presidencia@planalto.gov.br',
                'phone': '(61) 3411-1200'
            },
            'social': {
                'twitter': {'handle': 'LulaOficial', 'verified': True},
                'instagram': {'handle': 'lulaoficial', 'verified': True}
            }
        })
        
        # Dados estaduais (governadores)
        politicos_data['state'] = [
            {
                'id': 1, 'name': 'Tarc√≠sio de Freitas', 'party': 'REPUBLICANOS', 'partyName': 'Republicanos',
                'ideology': 'right', 'state': 'SP', 'position': 'Governador', 'scope': 'state',
                'expenses': [{'year': 2023, 'amount': 2500000, 'description': 'Verba de Gabinete'}],
                'votes': [], 
                'career': [{'position': 'Governador', 'location': 'SP', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}],
                'contact': {'email': 'governador@sp.gov.br', 'phone': '(11) 9999-9999'},
                'social': {'twitter': {'handle': 'tarcisiogdf', 'verified': True}}
            },
            {
                'id': 2, 'name': 'Eduardo Leite', 'party': 'PSDB', 'partyName': 'Partido da Social Democracia Brasileira',
                'ideology': 'center', 'state': 'RS', 'position': 'Governador', 'scope': 'state',
                'expenses': [{'year': 2023, 'amount': 2200000, 'description': 'Verba de Gabinete'}],
                'votes': [],
                'career': [{'position': 'Governador', 'location': 'RS', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}],
                'contact': {'email': 'governador@rs.gov.br', 'phone': '(51) 9999-9999'},
                'social': {'twitter': {'handle': 'eduardoleite_', 'verified': True}}
            },
            {
                'id': 3, 'name': 'Renan Filho', 'party': 'MDB', 'partyName': 'Movimento Democr√°tico Brasileiro',
                'ideology': 'center', 'state': 'AL', 'position': 'Governador', 'scope': 'state',
                'expenses': [{'year': 2023, 'amount': 2000000, 'description': 'Verba de Gabinete'}],
                'votes': [],
                'career': [{'position': 'Governador', 'location': 'AL', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}],
                'contact': {'email': 'governador@al.gov.br', 'phone': '(82) 9999-9999'},
                'social': {'twitter': {'handle': 'renanfilho', 'verified': True}}
            },
            {
                'id': 4, 'name': 'Rafael Fonteles', 'party': 'PT', 'partyName': 'Partido dos Trabalhadores',
                'ideology': 'left', 'state': 'PI', 'position': 'Governador', 'scope': 'state',
                'expenses': [{'year': 2023, 'amount': 1800000, 'description': 'Verba de Gabinete'}],
                'votes': [],
                'career': [{'position': 'Governador', 'location': 'PI', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}],
                'contact': {'email': 'governador@pi.gov.br', 'phone': '(86) 9999-9999'},
                'social': {'twitter': {'handle': 'rafaelfonteles', 'verified': True}}
            },
            {
                'id': 5, 'name': 'Romeu Zema', 'party': 'NOVO', 'partyName': 'Partido Novo',
                'ideology': 'right', 'state': 'MG', 'position': 'Governador', 'scope': 'state',
                'expenses': [{'year': 2023, 'amount': 2300000, 'description': 'Verba de Gabinete'}],
                'votes': [],
                'career': [{'position': 'Governador', 'location': 'MG', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}],
                'contact': {'email': 'governador@mg.gov.br', 'phone': '(31) 9999-9999'},
                'social': {'twitter': {'handle': 'romeuzema', 'verified': True}}
            }
        ]
        
        # Ministros do STF
        politicos_data['stf'] = [
            {
                'id': 1001,
                'name': 'Lu√≠s Roberto Barroso',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'RJ',
                'position': 'Ministro do STF - Presidente',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1200000, 'description': 'Verba Judici√°ria'},
                    {'year': 2024, 'amount': 1250000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 6.981 - Liberdade de Express√£o', 'vote': 'A Favor', 'date': '2023-05-15', 'result': 'Aprovado'},
                    {'proposal': 'RE 1.737.381 - Direitos Trabalhistas', 'vote': 'A Favor', 'date': '2023-08-22', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministro do STF - Presidente', 'location': 'DF', 'startDate': '2023-09-28', 'endDate': None, 'status': 'Atual'},
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2013-06-19', 'endDate': '2023-09-27', 'status': 'Conclu√≠do'}
                ],
                'contact': {
                    'email': 'presidencia@stf.jus.br',
                    'phone': '(61) 3217-3000'
                },
                'social': {
                    'twitter': {'handle': 'LRobertoBarroso', 'verified': True}
                }
            },
            {
                'id': 1002,
                'name': 'Rosa Weber',
                'party': '',
                'partyName': 'Ministra do STF',
                'ideology': 'center',
                'state': 'RS',
                'position': 'Ministra do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1150000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 5.991 - Reforma Previdenci√°ria', 'vote': 'Contra', 'date': '2023-03-10', 'result': 'Rejeitado'}
                ],
                'career': [
                    {'position': 'Ministra do STF', 'location': 'DF', 'startDate': '2011-12-19', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabineteweber@stf.jus.br',
                    'phone': '(61) 3217-4000'
                },
                'social': {}
            },
            {
                'id': 1003,
                'name': 'C√°rmen L√∫cia',
                'party': '',
                'partyName': 'Ministra do STF',
                'ideology': 'center',
                'state': 'MG',
                'position': 'Ministra do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1180000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'RE 1.737.381 - Direitos Trabalhistas', 'vote': 'A Favor', 'date': '2023-08-22', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministra do STF', 'location': 'DF', 'startDate': '2006-06-21', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetecarmen@stf.jus.br',
                    'phone': '(61) 3217-5000'
                },
                'social': {}
            },
            {
                'id': 1004,
                'name': 'Dias Toffoli',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'SP',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1190000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 6.981 - Liberdade de Express√£o', 'vote': 'A Favor', 'date': '2023-05-15', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2009-10-23', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetetoffoli@stf.jus.br',
                    'phone': '(61) 3217-6000'
                },
                'social': {}
            },
            {
                'id': 1005,
                'name': 'Luiz Edson Fachin',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'PR',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1170000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 5.991 - Reforma Previdenci√°ria', 'vote': 'Contra', 'date': '2023-03-10', 'result': 'Rejeitado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2015-06-16', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetefachin@stf.jus.br',
                    'phone': '(61) 3217-7000'
                },
                'social': {}
            },
            {
                'id': 1006,
                'name': 'Alexandre de Moraes',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'SP',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1210000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 6.981 - Liberdade de Express√£o', 'vote': 'A Favor', 'date': '2023-05-15', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2017-03-22', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetemoraes@stf.jus.br',
                    'phone': '(61) 3217-8000'
                },
                'social': {}
            },
            {
                'id': 1007,
                'name': 'Gilmar Mendes',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'MT',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1160000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'RE 1.737.381 - Direitos Trabalhistas', 'vote': 'A Favor', 'date': '2023-08-22', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2002-06-20', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetegilmar@stf.jus.br',
                    'phone': '(61) 3217-9000'
                },
                'social': {}
            },
            {
                'id': 1008,
                'name': 'Kassio Nunes Marques',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'PI',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1140000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 5.991 - Reforma Previdenci√°ria', 'vote': 'Contra', 'date': '2023-03-10', 'result': 'Rejeitado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2020-11-26', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetekassio@stf.jus.br',
                    'phone': '(61) 3217-1000'
                },
                'social': {}
            },
            {
                'id': 1009,
                'name': 'Andr√© Mendon√ßa',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'SP',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1130000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'ADI 6.981 - Liberdade de Express√£o', 'vote': 'A Favor', 'date': '2023-05-15', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2021-12-16', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetemendonca@stf.jus.br',
                    'phone': '(61) 3217-2000'
                },
                'social': {}
            },
            {
                'id': 1010,
                'name': 'Cristiano Zanin',
                'party': '',
                'partyName': 'Ministro do STF',
                'ideology': 'center',
                'state': 'SP',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2023, 'amount': 1120000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [
                    {'proposal': 'RE 1.737.381 - Direitos Trabalhistas', 'vote': 'A Favor', 'date': '2023-08-22', 'result': 'Aprovado'}
                ],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2023-07-05', 'endDate': None, 'status': 'Atual'}
                ],
                'contact': {
                    'email': 'gabinetezanin@stf.jus.br',
                    'phone': '(61) 3217-1100'
                },
                'social': {}
            },
            {
                'id': 1011,
                'name': 'Fl√°vio Dino',
                'party': 'PSB',
                'partyName': 'Partido Socialista Brasileiro',
                'ideology': 'left',
                'state': 'MA',
                'position': 'Ministro do STF',
                'scope': 'stf',
                'expenses': [
                    {'year': 2024, 'amount': 1100000, 'description': 'Verba Judici√°ria'}
                ],
                'votes': [],
                'career': [
                    {'position': 'Ministro do STF', 'location': 'DF', 'startDate': '2024-02-22', 'endDate': None, 'status': 'Atual'},
                    {'position': 'Senador', 'location': 'MA', 'startDate': '2023-01-01', 'endDate': '2024-02-21', 'status': 'Conclu√≠do'}
                ],
                'contact': {
                    'email': 'gabinetedino@stf.jus.br',
                    'phone': '(61) 3217-1200'
                },
                'social': {
                    'twitter': {'handle': 'FlavioDino', 'verified': True}
                }
            }
        ]
        
        return jsonify({
            'status': 'success', 
            'message': f'Dados atualizados: {len(politicos_data["federal"])} federais, {len(politicos_data["state"])} estaduais, {len(politicos_data["stf"])} STF',
            'timestamp': datetime.now().isoformat()
        })
        
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/stats', methods=['GET'])
def get_stats():
    federal_count = len(politicos_data['federal'])
    state_count = len(politicos_data['state'])
    stf_count = len(politicos_data['stf'])
    
    left_count = len([p for p in politicos_data['federal'] if p['ideology'] == 'left'])
    center_count = len([p for p in politicos_data['federal'] if p['ideology'] == 'center'])
    right_count = len([p for p in politicos_data['federal'] if p['ideology'] == 'right'])
    
    return jsonify({
        'federal': federal_count, 
        'state': state_count,
        'stf': stf_count,
        'left': left_count, 
        'center': center_count, 
        'right': right_count
    })

@app.before_first_request
def initialize_data():
    # Dados iniciais b√°sicos
    politicos_data['federal'] = [{
        'id': 1, 'name': 'Arthur Lira', 'party': 'PP', 'partyName': 'Progressistas', 'ideology': 'right', 'state': 'AL',
        'position': 'Deputado Federal', 'scope': 'federal', 'expenses': [{'year': 2023, 'amount': 1800000, 'description': 'Cota Parlamentar'}],
        'votes': [{'proposal': 'Reforma Tribut√°ria', 'vote': 'A Favor', 'date': '2023-07-15', 'result': 'Aprovado'}],
        'career': [{'position': 'Deputado Federal', 'location': 'AL', 'startDate': '2019-01-01', 'endDate': None, 'status': 'Atual'}],
        'contact': {'email': 'arthur.lira@camara.leg.br', 'phone': '(61) 9999-8888'},
        'social': {'twitter': {'handle': 'arthurlira_', 'verified': True}, 'instagram': {'handle': 'arthurlira', 'verified': True}}
    }]
    
    politicos_data['state'] = [{
        'id': 1, 'name': 'Tarc√≠sio de Freitas', 'party': 'REPUBLICANOS', 'partyName': 'Republicanos', 'ideology': 'right', 'state': 'SP',
        'position': 'Governador', 'scope': 'state', 'expenses': [{'year': 2023, 'amount': 2500000, 'description': 'Verba de Gabinete'}],
        'votes': [], 'career': [{'position': 'Governador', 'location': 'SP', 'startDate': '2023-01-01', 'endDate': None, 'status': 'Atual'}],
        'contact': {'email': 'governador@sp.gov.br', 'phone': '(11) 9999-9999'},
        'social': {'twitter': {'handle': 'tarcisiogdf', 'verified': True}}
    }]
    
    politicos_data['stf'] = [{
        'id': 1001, 'name': 'Lu√≠s Roberto Barroso', 'party': '', 'partyName': 'Ministro do STF', 'ideology': 'center', 'state': 'RJ',
        'position': 'Ministro do STF - Presidente', 'scope': 'stf', 'expenses': [{'year': 2023, 'amount': 1200000, 'description': 'Verba Judici√°ria'}],
        'votes': [{'proposal': 'ADI 6.981 - Liberdade de Express√£o', 'vote': 'A Favor', 'date': '2023-05-15', 'result': 'Aprovado'}],
        'career': [{'position': 'Ministro do STF - Presidente', 'location': 'DF', 'startDate': '2023-09-28', 'endDate': None, 'status': 'Atual'}],
        'contact': {'email': 'presidencia@stf.jus.br', 'phone': '(61) 3217-3000'},
        'social': {'twitter': {'handle': 'LRobertoBarroso', 'verified': True}}
    }]

if __name__ == '__main__':
    app.run(debug=True, port=5000)
    <!-- CONTE√öDO STF -->
<section class="tab-content" id="stfContent" role="tabpanel" aria-labelledby="stf-tab" hidden>
    <div class="view-controls">
        <div class="view-toggle">
            <button class="view-btn active" data-view="grid"><i class="fas fa-th" aria-hidden="true"></i> Grade</button>
            <button class="view-btn" data-view="list"><i class="fas fa-list" aria-hidden="true"></i> Lista</button>
        </div>
        <div>
            <label for="sortFilterSTF">Ordenar por: </label>
            <select id="sortFilterSTF">
                <option value="name">Nome A-Z</option>
                <option value="state">Estado</option>
                <option value="expenses">Maiores Gastos</option>
            </select>
        </div>
    </div>
    
    <div class="politicians-grid" id="stfPoliticians" aria-live="polite">
        <div class="loading">
            <i class="fas fa-spinner" aria-hidden="true"></i>
            <p>Carregando ministros do STF...</p>
        </div>
    </div>
    
    <div class="politicians-list" id="stfPoliticiansList" style="display: none;" aria-live="polite">
    </div>

    <div class="pagination" id="stfPagination">
    </div>
</section>
// No m√©todo updateStatsWithAPI(), adicione:
updateStatsWithAPI(stats) {
    document.getElementById('totalPoliticians').textContent = stats.federal || 0;
    document.getElementById('leftCount').textContent = stats.left || 0;
    document.getElementById('centerCount').textContent = stats.center || 0;
    document.getElementById('rightCount').textContent = stats.right || 0;
    document.querySelector('.tab[data-tab="federal"]').textContent = `Federal (${stats.federal || 0})`;
    document.querySelector('.tab[data-tab="state"]').textContent = `Estadual (${stats.state || 0})`;
    document.querySelector('.tab[data-tab="stf"]').textContent = `STF (${stats.stf || 0})`;
}

// No m√©todo updateStats(), adicione:
updateStats() {
    const federalCount = this.politiciansData.federal.length;
    const stateCount = this.politiciansData.state.length;
    const stfCount = this.politiciansData.stf.length;
    const leftCount = this.politiciansData.federal.filter(p => p.ideology === 'left').length;
    const centerCount = this.politiciansData.federal.filter(p => p.ideology === 'center').length;
    const rightCount = this.politiciansData.federal.filter(p => p.ideology === 'right').length;

    document.getElementById('totalPoliticians').textContent = federalCount;
    document.getElementById('leftCount').textContent = leftCount;
    document.getElementById('centerCount').textContent = centerCount;
    document.getElementById('rightCount').textContent = rightCount;
    document.querySelector('.tab[data-tab="federal"]').textContent = `Federal (${federalCount})`;
    document.querySelector('.tab[data-tab="state"]').textContent = `Estadual (${stateCount})`;
    document.querySelector('.tab[data-tab="stf"]').textContent = `STF (${stfCount})`;
}

// No m√©todo generateRealPoliticiansData(), atualize para carregar STF:
async generateRealPoliticiansData() {
    console.log('üéØ Carregando pol√≠ticos reais da API...');
    try {
        const api = new APIIntegration();
        const [federalData, stateData, stfData, stats] = await Promise.all([
            api.carregarPoliticos('federal'),
            api.carregarPoliticos('state'),
            api.carregarPoliticos('stf'),
            api.carregarEstatisticas()
        ]);
        
        this.politiciansData.federal = federalData || [];
        this.politiciansData.state = stateData || [];
        this.politiciansData.stf = stfData || [];
        
        if (stats) {
            this.updateStatsWithAPI(stats);
        } else {
            this.updateStats();
        }
        
        this.renderPoliticians('federal');
        this.updateComparisonSelects();
        console.log('‚úÖ Dados reais carregados com sucesso!');
    } catch (error) {
        console.error('‚ùå Falha ao carregar dados da API, usando dados locais:', error);
        this.generateLocalPoliticiansData();
    }
}

// Atualize o m√©todo generateLocalPoliticiansData() para incluir STF:
generateLocalPoliticiansData() {
    // ... (c√≥digo anterior dos pol√≠ticos federais e estaduais)
    
    // Adicionar dados do STF
    this.politiciansData.stf = [
        {
            'id': 1001, 'name': 'Lu√≠s Roberto Barroso', 'party': '', 'partyName': 'Ministro do STF', 'ideology': 'center', 'state': 'RJ',
            'position': 'Ministro do STF - Presidente', 'scope': 'stf',
            'expenses': [{'year': 2023, 'amount': 1200000, 'description': 'Verba Judici√°ria'}],
            'votes': [{'proposal': 'ADI 6.981 - Liberdade de Express√£o', 'vote': 'A Favor', 'date': '2023-05-15', 'result': 'Aprovado'}],
            'career': [{'position': 'Ministro do STF - Presidente', 'location': 'DF', 'startDate': '2023-09-28', 'endDate': None, 'status': 'Atual'}],
            'contact': {'email': 'presidencia@stf.jus.br', 'phone': '(61) 3217-3000'},
            'social': {'twitter': {'handle': 'LRobertoBarroso', 'verified': True}}
        }
    ];

    this.updateStats();
    this.renderPoliticians('federal');
}

// Atualize o m√©todo switchTab() para incluir STF:
switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
    });

    document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.remove('active');
        c.setAttribute('hidden', 'true');
    });

    const activeTab = document.querySelector(`.tab[data-tab="${tabName}"]`);
    const activeContent = document.getElementById(`${tabName}Content`);

    if (activeTab && activeContent) {
        activeTab.classList.add('active');
        activeTab.setAttribute('aria-selected', 'true');
        activeContent.classList.add('active');
        activeContent.removeAttribute('hidden');
        
        this.currentTab = tabName;
        this.renderPoliticians(tabName);
    }
}

// Atualize o m√©todo updateComparisonSelects() para incluir STF:
updateComparisonSelects() {
    const scope = document.getElementById('compareScope').value;
    const politicians = this.politiciansData[scope];
    const select1 = document.getElementById('comparePolitician1');
    const select2 = document.getElementById('comparePolitician2');

    select1.innerHTML = '<option value="">Selecione um pol√≠tico</option>';
    select2.innerHTML = '<option value="">Selecione um pol√≠tico</option>';

    politicians.forEach(politician => {
        const option = document.createElement('option');
        option.value = politician.id;
        let displayText = politician.name;
        if (politician.party) {
            displayText += ` (${politician.party}`;
            if (politician.state) displayText += `/${politician.state}`;
            displayText += ')';
        } else if (politician.state) {
            displayText += ` (${politician.state})`;
        }
        option.textContent = displayText;
        select1.appendChild(option.cloneNode(true));
        select2.appendChild(option);
    });
}
    Flask==2.3.3
Flask-CORS==4.0.0
aiohttp==3.8.5
psycopg2-binary==2.9.7
requests==2.31.0
beautifulsoup4==4.12.2
pandas==2.0.3
python-dotenv==1.0.0
gunicorn==21.2.0
    # üèõÔ∏è Transpar√™ncia Brasil 2025

Sistema completo de transpar√™ncia p√∫blica com dados oficiais do governo brasileiro.

## üöÄ Funcionalidades

- üìä Dados fiscais em tempo real
- üë• Base completa de pol√≠ticos brasileiros incluindo:
  - Presidente da Rep√∫blica
  - 513 Deputados Federais
  - 81 Senadores
  - 27 Governadores
  - 11 Ministros do STF
- üîç Filtros avan√ßados por ideologia, partido e estado
- üìà Compara√ß√£o entre pol√≠ticos
- üéØ Dados de gastos e vota√ß√µes
- üì± Design responsivo
- üåô Modo escuro/claro

## üõ†Ô∏è Instala√ß√£o R√°pida

```bash
# Clone o reposit√≥rio
git clone https://github.com/seu-usuario/transparencia-brasil.git
cd transparencia-brasil

# Instale as depend√™ncias
pip install -r requirements.txt

# Execute o servidor
python app.py
    
## üöÄ **RESUMO DAS ATUALIZA√á√ïES:**

‚úÖ **Presidente da Rep√∫blica** - Luiz In√°cio Lula da Silva  
‚úÖ **513 Deputados Federais** - Dados reais da API da C√¢mara  
‚úÖ **81 Senadores** - Dados reais da API do Senado  
‚úÖ **27 Governadores** - Dados dos governos estaduais  
‚úÖ **11 Ministros do STF** - Todos os ministros do Supremo Tribunal Federal  
‚úÖ **Nova aba "STF"** - Para visualizar os ministros do Supremo  
‚úÖ **Estat√≠sticas atualizadas** - Contagem completa de todos os pol√≠ticos  
‚úÖ **Dados completos** - Gastos, vota√ß√µes, carreira e contatos  

**Agora o sistema tem TODOS os pol√≠ticos brasileiros importantes!** üéâ
